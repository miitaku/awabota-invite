function doPost(e) {
  const ss = SpreadsheetApp.openById("10SI3cZ9Cxv13VXiQk0Fd1OvVQTdTlFAnZlviRfdqycg");
  const sheet = ss.getSheetByName("紹介コード"); // シート名に応じて調整

  const timestamp = new Date();
  const ref = e.parameter.ref || "不明";

  sheet.appendRow([timestamp, ref]);

  return ContentService
    .createTextOutput(JSON.stringify({ result: "OK" }))
    .setMimeType(ContentService.MimeType.JSON);
}

function doOptions() {
  return ContentService.createTextOutput("")
    .setMimeType(ContentService.MimeType.TEXT)
    .setHeader("Access-Control-Allow-Origin", "*")
    .setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS")
    .setHeader("Access-Control-Allow-Headers", "Content-Type");
}
